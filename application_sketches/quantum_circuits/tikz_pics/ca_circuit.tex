\usetikzlibrary{decorations.pathreplacing,shapes.geometric,calc}


\begin{tikzpicture}[scale=0.35, thick] % , baseline = -3.5pt

    %% Ancilla Qubits

    \draw (-1,16) rectangle (1,18);
    \node[anchor=center] (text) at (0,17) {$\onehotmapof{0}$};
    \draw (1,17) -- (13.5,17);
    \draw (13.5,16) rectangle (16.5,18);
    \node[anchor=center] (text) at (15,17) {$\qcaencodingof{\hypercoreof{\seldim-1}}$};
    \draw (16.5,17) -- (20,17);

    \draw (15,10) -- (15,16);
    \drawvariabledot{15}{10}

    \node[anchor=center] (text) at (0,15.25) {$\vdots$};
    \node[anchor=center] (text) at (-2,15) {$\avariableof{[\seldim]}$};

    \draw (-1,12) rectangle (1,14);
    \node[anchor=center] (text) at (0,13) {$\onehotmapof{0}$};
    \draw (1,13) -- (11,13);
    \draw (11,12) rectangle (13,14);
    \node[anchor=center] (text) at (12,13) {$\qcaencodingof{\hypercoreof{0}}$};
    \draw (13,13) -- (20,13);

    \draw (12,6) -- (12,12);
    \drawvariabledot{12}{6}

    %% Statistic Qubits

    \draw (-1,9) rectangle (1,11);
    \node[anchor=center] (text) at (0,10) {$\onehotmapof{0}$};
    \draw (1,10) -- (7.5,10);
    \draw (7.5,9) rectangle (10.5,11);
    \node[anchor=center] (text) at (9,10) {$\qcbencodingof{f_{\seldim-1}}$};
    \draw (10.5,10) -- (20,10);

    \draw (9,-1) -- (9,9);
    \drawvariabledot{9}{3}
    \drawvariabledot{9}{-1}

    \node[anchor=center] (text) at (0,8.25) {$\vdots$};
    \node[anchor=center] (text) at (-2,8) {$\headvariables$};

    \draw (-1,5) rectangle (1,7);
    \node[anchor=center] (text) at (0,6) {$\onehotmapof{0}$};
    \draw (1,6) -- (5,6);
    \draw (5,5) rectangle (7,7);
    \node[anchor=center] (text) at (6,6) {$\qcbencodingof{f_{0}}$};
    \draw (7,6) -- (20,6);

    \draw (6,-1) -- (6,5);
    \drawvariabledot{6}{3}
    \drawvariabledot{6}{-1}

    %% Distributed Qubits

    \draw (-1,2) rectangle (1,4);
    \node[anchor=center] (text) at (0,3) {$\onehotmapof{0}$};
    \draw (1,3) -- (2,3);
    \draw (2,2) rectangle (4,4);
    \node[anchor=center] (text) at (3,3) {$H$};

    \draw (4,3) -- (20,3);

    \node[anchor=center] (text) at (0,1.25) {$\vdots$};
    \node[anchor=center] (text) at (-2,1) {$\shortcatvariables$};

    \draw (-1,-2) rectangle (1,0);
    \node[anchor=center] (text) at (0,-1) {$\onehotmapof{0}$};
    \draw (1,-1) -- (2,-1);
    \draw (2,-2) rectangle (4,0);
    \node[anchor=center] (text) at (3,-1) {$H$};

    \draw (4,-1) -- (20,-1);

    \drawqcmeasuresymbol{21}{17}
    \node[anchor=center] (text) at (21,15.25) {$\vdots$};
    \drawqcmeasuresymbol{21}{13}

    \drawqcmeasuresymbol{21}{3}
    \node[anchor=center] (text) at (21,1.25) {$\vdots$};
    \drawqcmeasuresymbol{21}{-1}

\end{tikzpicture}