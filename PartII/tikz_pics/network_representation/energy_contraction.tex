\begin{tikzpicture}[thick, scale=0.35] % , baseline = -3.5pt

\node[anchor=east] (text) at (-3,0) {$\sum_{\parindexof{[\parorder]}\in\parstates} \canparamat{\selvariableof{[\parorder]}=\parindexof{[\parorder]}} {\exformula_{\parindexof{[\parorder]}}} \quad {=}$};

%\node[anchor=center] (text) at (0.5,-8) {$\mathrm{log}$};

%\drawatomcore{3.5}{-8}{$\rencodingof{\fselectionmap}$}
%\drawatomindices{3.5}{-12}	
%
%
%\drawatomcore{3.5}{-4}{$\canparam$}
%\drawparindices{3.5}{-8}	



\drawatomindices{0}{-4}
\draw (-1,3) rectangle (5, -3);
\node[anchor=center] (text) at (2,0) {$\rencodingof{\fselectionmap}$};

\draw[->] (2,3)--(2,5) node[midway,right] {\tiny $\catvariableof{\fselectionmap}$}; 
\draw (1,5) rectangle (3,7);
\node[anchor=center] (text) at (2,6) {$\tbasis$};

\draw[<-] (5,-2)--(7,-2) node[midway,below] {\tiny $\selvariableof{0}$}; 
\draw[<-] (5,-0.5)--(7,-0.5) node[midway,below] {\tiny $\selvariableof{1}$}; 
\node[anchor=center] (text) at (6,0.75) {$\vdots$};
\draw[<-] (5,2)--(7,2) node[midway,above] {\tiny $\selvariableof{\parorder\shortminus1}$}; 

\draw (7,3) rectangle (9,-3);
\node[anchor=center] (text) at (8,0) {$\canparam$};

\end{tikzpicture}