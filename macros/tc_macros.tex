%% CONTRACTIONS
\newcommand{\contractionof}[2]{\left\langle #1\right\rangle \left[ #2 \right]}

\newcommand{\breakablecontractionof}[2]{\big\langle #1 \big\rangle \big[ #2 \big]}
\newcommand{\sbcontractionof}[2]{\contractionof{#1}{#2}}
\newcommand{\contraction}[1]{\contractionof{#1}{\varnothing}}
\newcommand{\sbcontraction}[1]{\contraction{#1}}
\newcommand{\normationofwrt}[3]{\left\langle #1\right\rangle \left[ #2 | #3 \right]}
\newcommand{\sbnormationofwrt}[3]{\normationofwrt{#1}{#2}{#3}}
\newcommand{\normationof}[2]{\normationofwrt{#1}{#2}{\varnothing}}
\newcommand{\sbnormationof}[2]{\sbnormationofwrt{#1}{#2}{\varnothing}}

\newcommand{\nzcontractionof}[2]{\nonzerocirc\contractionof{#1}{#2}}

%% ENCODING SCHEMES
\newcommand{\rencodingof}[1]{\rho^{#1}}
\newcommand{\rencodingofat}[2]{\rencodingof{#1}\left[#2\right]}

\newcommand{\sencodingof}[1]{\gamma^{#1}}
\newcommand{\sencodingofat}[2]{\sencodingof{#1}\left[#2\right]}  

\newcommand{\bencodingof}[1]{\beta^{#1}}
\newcommand{\bencodingofat}[2]{\bencodingof{#1}\left[#2\right]}  

\newcommand{\linmap}{F}
\newcommand{\linmapof}[1]{\linmap^{#1}}
\newcommand{\linmapofat}[2]{\linmapof{#1}\left(#2\right)}
\newcommand{\linmapspace}{\mathbb{L}}

%% Directed Tensor Calculus
\newcommand{\exrelation}{\mathcal{R}}
\newcommand{\exrelationof}[1]{\exrelation^{#1}}
\newcommand{\arbset}{\mathcal{U}}
\newcommand{\arbsetof}[1]{\arbset^{#1}}
\newcommand{\arbsubset}{\mathcal{V}} % Conflicts with nodes!
\newcommand{\arbelement}{u}
\newcommand{\arbelementin}{\arbelement\in\arbset}

\newcommand{\insymbol}{\mathrm{in}}
\newcommand{\outsymbol}{\mathrm{out}}
\newcommand{\inset}{\arbsetof{\insymbol}}
\newcommand{\outset}{\arbsetof{\outsymbol}}

\newcommand{\incatindex}{\catindexof{\insymbol}}
\newcommand{\outcatindex}{\catindexof{\outsymbol}}

%% Sparse Tensor Calculus
\newcommand{\sparsityof}[1]{\ell_0\left(#1\right)}


%% MAIN VARIABLES
\newcommand{\indvariable}{O} 
\newcommand{\inddim}{r}
\newcommand{\indindex}{o} % was s
\newcommand{\indenumerator}{l}
\newcommand{\indorder}{n} % number of variables 

\newcommand{\selvariable}{L} 
\newcommand{\seldim}{p}
\newcommand{\selindex}{l}
\newcommand{\selenumerator}{s}
\newcommand{\selorder}{n}

\newcommand{\catvariable}{X} 
\newcommand{\catdim}{m}
\newcommand{\catindex}{x} % was i
\newcommand{\catenumerator}{\atomenumerator}
\newcommand{\catorder}{\atomorder}

\newcommand{\headvariable}{Y} % head of a relational encoding
\newcommand{\headdim}{n}
\newcommand{\headindex}{y}

\newcommand{\datvariable}{J} % Can be understood as selvariable selecting a datapoint, catvariable as a random datapoint, indvariable as a abstract object representing the sample, also used at indexvariable!
\newcommand{\datdim}{m}
\newcommand{\datindex}{j}

%% Syntactic Sugar
\newcommand{\indvariableof}[1]{\indvariable_{#1}}
\newcommand{\selvariableof}[1]{\selvariable_{#1}}
\newcommand{\catvariableof}[1]{\catvariable_{#1}}
\newcommand{\headvariableof}[1]{\headvariable_{#1}}

\newcommand{\indvariablelist}{\indvariableof{0},\ldots,\indvariableof{\individualorder-1}}
\newcommand{\catvariablelist}{\catvariableof{0},\ldots,\catvariableof{\atomorder-1}}
\newcommand{\selvariablelist}{\selvariableof{0},\ldots,\selvariableof{\selorder-1}}

\newcommand{\shortindvariablelist}{\indvariableof{[\individualorder]}}
\newcommand{\shortcatvariablelist}{\catvariableof{[\atomorder]}}
\newcommand{\shortselvariablelist}{\selvariableof{[\selorder]}}

\newcommand{\selindices}{\selindexof{0},\ldots,\selindexof{\selorder-1}}

\newcommand{\shortindindices}{\indindexof{[\indorder]}}
\newcommand{\shortcatindices}{\catindexof{[\catorder]}}
\newcommand{\shortselindices}{\selindexof{[\selorder]}}

\newcommand{\inddimof}[1]{\inddim_{#1}}
\newcommand{\seldimof}[1]{\seldim_{#1}}
\newcommand{\catdimof}[1]{\catdim_{#1}}
\newcommand{\headdimof}[1]{\headdim_{#1}}

\newcommand{\indindexof}[1]{\indindex_{#1}}
\newcommand{\selindexof}[1]{\selindex_{#1}}
\newcommand{\catindexof}[1]{\catindex_{#1}} 
\newcommand{\headindexof}[1]{\headindex_{#1}}

\newcommand{\indindexin}{\indindex\in[\inddim]}
\newcommand{\selindexin}{\selindex\in[\seldim]}
\newcommand{\catindexin}{\catindex\in[\catdim]}
\newcommand{\datindexin}{\datindex\in[\datdim]}

\newcommand{\indindexofin}[1]{\indindexof{#1}\in[\inddimof{#1}]}
\newcommand{\catindexofin}[1]{\catindexof{#1}\in[\catdimof{#1}]}
\newcommand{\selindexofin}[1]{\selindexof{#1}\in[\seldimof{#1}]}

\newcommand{\indindexlist}{\indindexof{0},\ldots,\indindexof{\indorder-1}}
\newcommand{\catindexlist}{\catindexof{0},\ldots,\catindexof{\atomorder-1}}
\newcommand{\selindexlist}{\selindexof{0},\ldots,\selindexof{\selorder-1}}

\newcommand{\indenumeratorin}{\indenumerator\in[\indorder]}
\newcommand{\selenumeratorin}{\selenumerator\in[\selorder]}
\newcommand{\catenumeratorin}{\catenumerator\in[\catorder]}

\newcommand{\indexedindvariableof}[1]{\indvariableof{#1}=\indindexof{#1}}
\newcommand{\indexedcatvariableof}[1]{\catvariableof{#1}=\catindexof{#1}}
\newcommand{\indexedselvariableof}[1]{\selvariableof{#1}=\selindexof{#1}}
\newcommand{\indexedheadvariableof}[1]{\headvariableof{#1}=\headindexof{#1}}

\newcommand{\indexedindvariable}{\indexedindvariableof{}}
\newcommand{\indexedcatvariable}{\indexedcatvariableof{}}
\newcommand{\indexedselvariable}{\indexedselvariableof{}}

\newcommand{\catstatesof}[1]{[\catdimof{#1}]}

\newcommand{\catspaceof}[1]{\rr^{\catdimof{#1}}}

\newcommand{\indspace}{\bigotimes_{\indenumeratorin}\rr^{\inddim}}
\newcommand{\catspace}{\bigotimes_{\atomenumeratorin} \rr^{\catdimof{\atomenumerator}}}

\newcommand{\selstates}{\bigtimes_{\selenumeratorin}[\seldimof{\selenumerator}]}
\newcommand{\selvectorspace}{\rr^{\seldim}}
\newcommand{\selspace}{\bigotimes_{\selenumeratorin}\rr^{\seldimof{\selenumerator}}}
%%

\newcommand{\datanum}{\datdim}

\newcommand{\datain}{\datindex\in[\datanum]}
\newcommand{\data}{\{\datapointof{\datindex}\}_{\datindexin}}
\newcommand{\dataaverage}{\frac{1}{\datanum}\sum_{\datindexin}}

\newcommand{\catvariables}{\catvariablelist}
\newcommand{\shortcatvariables}{\shortcatvariablelist}
\newcommand{\indexedshortcatvariables}{\shortcatvariables=\shortcatindices}
\newcommand{\shortcatindicesin}{\shortcatindices\in\facstates}
\newcommand{\shortatomindicesin}{\shortcatindices\in\atomstates}
\newcommand{\datshortcatvariables}{\shortcatvariables=\shortcatindices^{\datindex}}

\newcommand{\shortindvariables}{\shortindvariablelist}
\newcommand{\indexedshortindvariables}{\shortindvariables=\shortindindices}
\newcommand{\datshortindvariables}{\shortindvariables=\shortindindices^{\datindex}}

\newcommand{\selvariables}{\selvariableof{0},\ldots,\selvariableof{\selorder-1}}
\newcommand{\shortselvariables}{\selvariableof{[\selorder]}}
\newcommand{\indexedshortselvariables}{\shortselvariables=\shortselindices}
\newcommand{\secselenumerator}{\tilde{\selenumerator}}

\newcommand{\nodestatesof}[1]{\bigtimes_{\node\in#1}\catstatesof{\node}}
\newcommand{\atomstates}{\bigtimes_{\atomenumeratorin}[2]}


\newcommand{\symindstates}{\bigtimes_{\indenumeratorin}[\inddim]}

\newcommand{\facstates}{\bigtimes_{\atomenumeratorin}\catstatesof{\atomenumerator}}
\newcommand{\facdim}{\prod_{\atomenumeratorin}\catdimof{\atomenumerator}}
\newcommand{\secfacstates}{\bigtimes_{\secatomenumerator\in[\secatomorder]}\catstatesof{\secatomenumerator}}

\newcommand{\atomspace}{\bigotimes_{\atomenumeratorin}\rr^2}
\newcommand{\facspace}{\catspace}
\newcommand{\secfacspace}{\bigotimes_{\secatomenumerator\in[\seccatorder]} \rr^{\catdimof{\secatomenumerator}}}

\newcommand{\indexedcatvariables}{\indexedcatvariableof{0},\ldots,\indexedcatvariableof{\atomorder-1}} 
\newcommand{\tildeindexedcatvariables}{\catvariableof{0}=\tilde{\catindex}_0,\ldots,\catvariableof{\atomorder-1}=\tilde{\catindex}_{\atomorder-1}} 

\newcommand{\seccatenumerator}{\tilde{\catenumerator}}
\newcommand{\seccatenumeratorin}{\seccatenumerator\in[\catorder]}

\newcommand{\seccatvariable}{Y} % used as differentiation variable
\newcommand{\seccatindex}{y}
\newcommand{\seccatorder}{p} % Has to coincide with seldim for relational encoding def

\newcommand{\seccatvariableof}[1]{\seccatvariable_{#1}}
\newcommand{\indexedseccatvariableof}[1]{\seccatvariableof{#1}=\seccatindexof{#1}}
\newcommand{\seccatvariables}{\seccatvariableof{0},\ldots,\seccatvariableof{\seccatorder\shortminus1}}
\newcommand{\secshortcatvariables}{\seccatvariableof{[\seccatorder]}}
\newcommand{\indexedseccatvariables}{\indexedseccatvariableof{0}\ldots,\indexedseccatvariableof{\seccatorder-1}} 
\newcommand{\indexedsecshortcatvariables}{\indexedseccatvariableof{[\seccatorder]}}

\newcommand{\catvariablesinset}[1]{\catvariableof{#1}}%{\catvariableof{\node} \, : \, \node \in #1}
\newcommand{\seccatindexof}[1]{\seccatindex_{#1}}

\newcommand{\catindices}{\catindexlist}
\newcommand{\tildecatindexof}[1]{\tilde{\catindex}_{#1}}
\newcommand{\tildecatindices}{\tildecatindexof{0},\ldots,\tildecatindexof{\atomorder-1}}
\newcommand{\seccatindices}{{\seccatindexof{0},\ldots,\seccatindexof{\secatomorder-1}}}
\newcommand{\tildeshortcatindices}{\tildecatindexof{[\catorder]}}

\newcommand{\catindicesof}[1]{{\catindexof{0}^{#1},\ldots,\catindexof{\atomorder-1}^{#1}}}

\newcommand{\catzeropositions}{\{\atomenumerator : \catindexof{\atomenumerator}=0\}}
\newcommand{\catonepositions}{\{\atomenumerator : \catindexof{\atomenumerator}=0\}}

%% Cores
\newcommand{\categoricalmap}{Z}
\newcommand{\categoricalmapat}[1]{\categoricalmap\left[#1\right]}
\newcommand{\categoricalmapof}[1]{\categoricalmap^{#1}}
\newcommand{\categoricalmapofat}[2]{\categoricalmap^{#1}\left[#2\right]}

\newcommand{\categoricalcore}{\rencodingof{\categoricalmap}}
\newcommand{\categoricalcoreof}[1]{\rencodingof{\categoricalmapof{#1}}}
\newcommand{\categoricalcoreofat}[2]{\rencodingof{\categoricalmapof{#1}}\left[#2\right]}

\newcommand{\datamap}{D}
\newcommand{\datamapat}[1]{\datamap(#1)}
\newcommand{\datamapof}[1]{\datamap_{#1}}
\newcommand{\datapointof}[1]{\datamapat{#1}}
\newcommand{\datapoint}{\datapointof{\datindex}}
\newcommand{\dataset}{\left((\catindicesof{\datindex})\,:\,\datindexin\right)}

\newcommand{\secdatamap}{\tilde{\datamap}}
\newcommand{\datacore}{\rencodingof{\datamap}}
\newcommand{\datacoreat}[1]{\datacore\left[#1\right]}
\newcommand{\datacoreof}[1]{\rencodingof{\datamap_{#1}}}
\newcommand{\datacoreofat}[2]{\rencodingof{\datamap_{#1}}[#2]}

\newcommand{\secdatacoreof}[1]{\rencodingof{\secdatamap_{#1}}}
\newcommand{\empdistribution}{\probtensor^{\datamap}}
\newcommand{\empdistributionat}[1]{\empdistribution\left[#1\right]}
\newcommand{\empdistributionwith}{\empdistributionat{\shortcatvariables}}

\newcommand{\varcore}[1]{U^{#1}} % For optimization of tensor network
\newcommand{\varspace}[1]{\rr^{p_{#1}}}
\newcommand{\varcollection}{\big\{\varcore{\atomenumerator}\, :\, \atomenumeratorin \big\}}

\newcommand{\headcore}{W} % activation of a formula, typical exp
\newcommand{\headcoreof}[1]{\headcore^{#1}}
\newcommand{\headcoreat}[1]{\headcore\left[#1\right]}
\newcommand{\headcoreofat}[2]{\headcore^{#1}[#2]}

\newcommand{\actcore}{W} % activation of a formula, typical exp
\newcommand{\actcoreof}[1]{\actcore^{#1}}
\newcommand{\actcoreofat}[2]{\actcore^{#1}[#2]}

%% CP Decomposition
\newcommand{\legcore}{V}
\newcommand{\legcoreof}[1]{\legcore^{#1}}
\newcommand{\legcoreofat}[2]{\legcoreof{#1}\left[#2\right]}

\newcommand{\scalarcore}{\sigma}
\newcommand{\scalarcoreof}[1]{\scalarcore[#1]}
\newcommand{\scalarcoreat}[1]{\scalarcore[#1]}
\newcommand{\scalarcoreofat}[2]{\scalarcore^{#1}[#2]}

% DecompositionIndex 
\newcommand{\decvariable}{I}
\newcommand{\decvariableof}[1]{\decvariable_{#1}}
\newcommand{\decindex}{i} % Needs to be different to datindex!
\newcommand{\decindexof}[1]{\decindex_{#1}}
\newcommand{\indexeddecvariableof}[1]{\decvariableof{#1}=\decindexof{#1}}
\newcommand{\decdim}{n}
\newcommand{\decdimof}[1]{\decdim_{#1}}
\newcommand{\decindexin}{\decindex\in[\decdim]}
\newcommand{\indexeddecvariable}{\decvariable=\decindex}
\newcommand{\inddecvar}{\indexeddecvariable}

\newcommand{\indexeddatvariable}{\datvariable=\datindex}

% Used in poly sparsity
\newcommand{\indexvariable}{\datvariable} % for datacores used
\newcommand{\indexset}{J}
\newcommand{\indexsetof}[1]{\indexset^{#1}}

\newcommand{\slackvariable}{z}
\newcommand{\slackindex}{z}
\newcommand{\slackindexof}[1]{\slackindex_{#1}}

\newcommand{\rankofat}[2]{\mathrm{rank}^{#1}\left(#2\right)}
\newcommand{\cprankof}[1]{\mathrm{rank}\left(#1\right)}
\newcommand{\bincprankof}[1]{\mathrm{rank}^{\mathrm{bin}}\left(#1\right)}
\newcommand{\slicesparsityof}[1]{\slicerankwrtof{\catorder}{#1}} % former {\tilde{\ell} \left(#1\right)}


\newcommand{\dircprankof}[1]{\mathrm{rank}^{\mathrm{dir}}\left(#1\right)}
\newcommand{\bascprankof}[1]{\mathrm{rank}^{\mathrm{bas}}\left(#1\right)}
\newcommand{\baspluscprankof}[1]{\mathrm{rank}^{\mathrm{bas+}}\left(#1\right)}
\newcommand{\quacprankof}[1]{\mathrm{rank}^{\mathrm{qua}}\left(#1\right)}

\newcommand{\sliceset}{\mathcal{M}}
\newcommand{\slicescalar}{\lambda}
\newcommand{\slicescalarof}[1]{\slicescalar^{#1}}
\newcommand{\slicetupleof}[1]{(\slicescalar^{#1}, \variablesetof{#1}, \catindexof{\variablesetof{#1}}^{#1})}
\newcommand{\enumeratedslices}{\{\slicetupleof{\decindex} \, : \, \decindexin\}}

\newcommand{\sliceorder}{r}
\newcommand{\slicerankwrtof}[2]{\mathrm{rank}^{#1}\left(#2\right)}
